/**
 * windmill.renderer.min.js v0.5.1.
 */
console.log("Start windmill renderer.min (0.5.1) framework. Build at 2018-12-05 14:27"),function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e["windmill-renderer"]=t()}(this,function(){"use strict";"function"!=typeof Object.assign&&Object.defineProperty(Object,"assign",{writable:!0,enumerable:!1,configurable:!0,value:function(e,t){var n=arguments;if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var o=Object(e),r=1;r<arguments.length;r++){var i=n[r];if(null!=i)for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(o[a]=i[a])}return o}});var t,i=(t=1e5,function(){var e=String(t);return t+=1,e});function r(){return"undefined"!=typeof global?global:"undefined"!=typeof self?self:new Function("return this")()}function u(t,n,e){void 0===e&&(e=!0);var o=r();try{Object.defineProperty(o,t,{value:n,configurable:!0,enumerable:!0,writable:!e})}catch(e){o[t]=n}}function s(e){return Object.prototype.toString.call(e).slice(8,-1)}function p(e){return"Object"===s(e)}function a(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t]}var n=function(){},g={},o=["debug","info","log","warn","error"];function c(e){if("object"==typeof process&&process&&process.env,!0===g.debugMode||"true"===g.debugMode)return!0;var t=g.logLevel||"error";return o.indexOf(e)>=o.indexOf(t)}function f(e){c("debug")&&n("debug",e)}function h(e){c("warn")&&n("warn",e)}function l(e){c("error")&&n("error",e)}function d(e){l(e)}n=function(e,t){var n,o="["+((n=e).charAt(0).toUpperCase()+n.slice(1))+"][wml-r] "+t;return g.isWeex&&-1<["Android","iOS"].indexOf(g.platform)?console.log(o):console.error(o)};var m={network:["request","uploadFile","downloadFile"],miniApp:["setAppShareInfo","hideLauncherLoading","setWebViewTop","setWebViewBackgroundImage","getConfig"],mtop:["request"],storage:["length","setItem","getItem","removeItem","clearStorage","getStorageInfo",{name:"getItemSync",sync:!0},{name:"setItemSync",sync:!0},{name:"removeItemSync",sync:!0},{name:"clearStorageSync",sync:!0},{name:"getStorageInfoSync",sync:!0}],memoryStorage:["setItem","getItem"],tabBar:["show","hide","setTabBarItem","setTabBarStyle","setTabBarBadge","removeTabBarBadge","showTabBarRedDot","hideTabBarRedDot"],navigator:["push","pop","openMessagePage","reloadPage","getBackStack","popToHome","navigateTo","redirectTo","switchTab","navigateBackMiniProgram","navigateToMiniProgram"],user:["login","logout","info"],modal:["alert","confirm","toast","hideToast","showLoading","hideLoading","prompt"],navigatorBar:["show","hide","setTitle","setRightItem","setStyle","setDrawer","setActionSheet","hasIndexBadge","scaleIndexBadge","resetIndexBadge","getHeight","openDrawer","isDrawerOpened","closeDrawer","setLeftItem","showMenu","hideMenu","getStatusBarHeight","setNavigationBar","hideNavigationBarLoading","showNavigationBarLoading"],clipboard:["writeText","readText"],picker:["pick","pickDate","pickTime","chooseCity"],webSocket:["webSocket","send","close","onOpen","onMessage","onClose","onError"],calendar:["addEvent","checkEvent","removeEvent"],connection:["getType","getDownlinkMax","onChange"],screen:["setAlwaysOn","setBrightness","getScreenBrightness"],broadcast:["createChannel","postMessage","onMessage","close"],share:["doShare"],cookie:["read","write","getAllObjects"],audio:["load","play","pause","stop","setVolume","canPlayType"],wopc:["authLogin","checkAuthSession","doAuth","getSessionKey","setSessionKey"],WopcMtopPlugin:["request"],device:["onShake","vibrate","vibrateShort","onUserCaptureScreen","offUserCaptureScreen"],keyboard:["hideKeyboard"],contact:["choosePhoneContact"],location:["getLocation"],alipay:["tradePay"],userTrack:["commit","commitut","commitEvent","customAdvance","pageAppear","pageDisappear","skipPage","updatePageUtparam","updateNextPageUtparam"],"nuvajs-exec":["exec"],aluWVJSBridge:["userIsLogin","refreshAlipayCookie"],TBDeviceInfo:["getUtdid"],actionSheet:["showActionSheet"],image:["chooseImage","previewImage","compressImage","getImageInfo","saveImage"],media:["startVoice","stopVoice"],audioRecord:["startRecord","stopRecord","cancelRecord"],audioPlayer:["playVoice","pauseVoice","stopVoice"],file:["saveFile","getFileInfo","getFileList","removeFile"],video:["chooseVideo","getVideoInfo","saveVideoToPhotosAlbum"],phone:["makePhoneCall"],compass:["startCompass","stopCompass","onCompassChange"],tbsecurity:["secureToken"],sendMtop:["request"],ZCache:["prefetch","fetch"],WVZCache:["prefetch","fetch"],sku:["show","hide"],chat:["open"],ucc:["uccBind","uccTrustLogin","uccUnbind"],address:["choose"]};var v="__windmill_post_message__",y="__windmill_on_message__",e=function(){};e.prototype.$on=function(e,t){return void 0===t&&(t=a),f('$on "'+e+'"'),!e&&d("invalid event name "+e+" for windmill.$on."),t===a&&d("bind event "+e+" with no callback through windmill.$on."),this.bridge.onReceiveMessage({data:{type:e},origin:this.label,type:"Event"},t)},e.prototype.$once=function(e,t){return void 0===t&&(t=a),f('$once "'+e+'"'),!e&&d("invalid event name "+e+" for windmill.$once."),t===a&&d("bind event "+e+" with no callback through windmill.$once."),this.bridge.onReceiveMessage({data:{type:e,once:!0},origin:this.label,type:"Event"},t)},e.prototype.$off=function(e,t){return f('$off "'+e+'"'),!e&&d("invalid event name "+e+" for windmill.$off."),this.bridge.unbindEventListener("Event."+e,t)},e.prototype.$cycle=function(e,t){return void 0===t&&(t=a),f('$cycle "'+e+'"'),e&&/^app:|^page(:|@)/.test(e)||d("invalid lifecycle name "+e+" for windmill.$cycle."),t===a&&d("hook lifecycle "+e+" with no callback function through windmill.$cycle."),"AppWorker"!==this.label&&/^app:/.test(e)&&d("Shouldn't bind lifecycle hook for app in a page client."),this.bridge.onReceiveMessage({type:"Lifecycle",origin:this.label,data:{type:e}},t)},e.prototype.$decycle=function(e,t){return f('$decycle "'+e+'"'),e&&/^app:|^page(:|@)/.test(e)||d("invalid lifecycle name "+e+" for windmill.$decycle."),this.bridge.unbindEventListener("Lifecycle."+e,t)},e.prototype.$emit=function(e,t,n){return void 0===t&&(t={}),f('$emit("'+e+'")'),!e&&d("invalid event name "+e+" for windmill.$emit."),n&&n!==this.label?this.bridge.postMessage({data:{type:e,data:t},origin:this.label,target:n,type:"Event"}):this.bridge.emitEvent(""+e,t)},e.prototype.$callAsync=function(n,o){var r=this;return void 0===o&&(o={}),f('$callAsync "'+n+'"'),n||d("invalid method name "+n+" for windmill.$callAsync."),new Promise(function(e,t){r.bridge.dispatchMessage({type:"ModuleCall",origin:r.label,target:"AppWorker",data:{method:n,params:o}},e,t,!1)})},e.prototype.$call=function(e,t,n,o){return void 0===t&&(t={}),void 0===n&&(n=a),void 0===o&&(o=a),f('$call "'+e+'", params: '+JSON.stringify(t)),e||d("invalid method name "+e+" for windmill.$call."),this.bridge.dispatchMessage({type:"ModuleCall",origin:this.label,target:"AppWorker",data:{method:e,params:t}},n,o,!0)},e.prototype.$registerModules=function(e){!function(t,r){if(void 0===r&&(r=!1),p(t)){var e=function(n){var e=t[n];m[n]?r||h('The "'+n+'" module has already been registered.It would be overridden.'):m[n]=[];var o=m[n];Array.isArray(e)?e.forEach(function(e){if(p(e))o.push(e);else if("string"==typeof e){var t=e;-1===o.indexOf(t)?o.push(t):r||h('The "'+t+'" of the "'+n+'" module has already been registered.')}}):l('Invalid parameter type! The method list of the "'+n+'" module should be an Array.')};for(var n in t)e(n)}else l("Invalid parameter type! The module definition is not a plain object.")}(e,!0)},e.prototype.$getAvailableModules=function(){return function(e){var t={};try{t=JSON.parse(JSON.stringify(e))}catch(e){}return t}(m)};var b="[[EVENT_MAP]]";function w(e,t){var n=e[b];return Array.isArray(n[t])||(n[t]=[]),n[t]}var M=function(){f("Create new EventEmitter."),Object.defineProperty(this,b,{configurable:!1,enumerable:!1,writable:!1,value:{}})};M.prototype.on=function(e,t){return f('EventEmitter: on("'+e+'")'),w(this,e).push({listener:t,once:!1,callCount:0}),this},M.prototype.once=function(e,t){return f('EventEmitter: once("'+e+'")'),w(this,e).push({listener:t,once:!0,callCount:0}),this},M.prototype.off=function(e,t){f('EventEmitter: off("'+e+'"'+(t?", listener":"")+")");var n=this[b];if(t){var o=n[e];if(Array.isArray(o)){var r=o.findIndex(function(e){return e.listener===t});-1!==r&&o.splice(r,1)}}else delete n[e];return this};var k,S=3;function _(t){var n;try{n=JSON.stringify(t)}catch(e){n=t}d("failed to postMessage: "+n)}function A(e,t,n,o,r,i){var a=t+"."+n;return e.WindVane?e.WindVane.call(t,n,o,r,i):d("should have WindVane in global context"+(a?" to call "+a:"")+".")}var I=!(M.prototype.emit=function(o){for(var e=[],t=arguments.length-1;0<t--;)e[t]=arguments[t+1];f('EventEmitter: emit("'+o+'", '+JSON.stringify(e)+")");var n=this[b],r=n[o];return Array.isArray(r)&&(n[o]=r.filter(function(t){try{t.listener.apply(null,e),t.callCount+=1}catch(e){throw l('Failed to emit the "'+o+'" event: '+e.toString()+"\nSource code: "+("function"==typeof(n=t.listener)?Function.prototype.toString.call(n):"")),e}var n;return!t.once})),this});var $=function(){this._messages=[]};$.prototype.postMessage=function(e){f("cache message in lazyMsgModule. "+JSON.stringify(e)),this._messages.push(e)},$.prototype.replaceWith=function(e){E=!1,this._messageModule=e,this._flush()},$.prototype._flush=function(){var t=this;this._messages.forEach(function(e){return t._messageModule.postMessage(e)})};var E,O,C=new $;function T(e,t){var n,o=e?(n=e).requireModule("@weex/windmill")||n.requireModule("windmill"):function(){var e=r();if("function"!=typeof e[v])return 0<S&&(S--,l("Can't find available \""+v+'" API in the context.')),!1;var t={};return t.postMessage=e[v],t.onmessage=function(e){f('Register the "'+y+'" API.'),u(y,e)},t}()||function(){if(!k){var t="undefined"!=typeof window?window:global;k={postMessage:function(e){return A(t,"Windmill","postMessage",e,function(){},_)},onmessage:function(e){if(!I)return I=!0,A(t,"Windmill","onMessage",{},e,_)}}}return k}();if(!o)return d("can't find message module ("+(e?"windmill module":"message module in webview")+")."),E=!0,C;if("function"==typeof t){f('Set the "onmessage" method to the bridge through callback.');try{o.onmessage(t)}catch(e){l('Failed to set the "onmessage" method to the bridge through callback.'),l(e.toString())}}return E&&C.replaceWith(o),o}function x(e){var t=e.match(/([^@]+)(@\S+)/);return t&&t[1]||e}var W=function(e,t){var a=this;void 0===t&&(t={}),f("Create a new RendererBridge."),O=t.isWeex,this._emitter=new M,f("Register onmessage api for "+(O?"Weex windmill module":"webview")+"."),O&&(this._weex=e),this._onMessage=function(e){if(f("Receive message from the worker. (message: "+JSON.stringify(e)+")"),!p(e)&&(l("The parameter of onmessage should be a plain object! Not "+s(e)),"string"==typeof e))try{e=JSON.parse(e)}catch(e){return void l("Failed to parse the message string. "+e.toString())}var t=e.type,n=e.data;void 0===n&&(n={});var o=e.origin,r=e.callbackId;switch(t){case"Callback":a._emitter.emit("callback@AppWorker:"+r,n);break;case"Event":var i=x(n.type);a._emitter.emit(t+"."+i,Object.assign({origin:o},n,{type:i}));break;case"Lifecycle":a._emitter.emit(t+"."+n.lifecycle,n.options);break;case"SetData":a._emitter.emit("Event.setdata",n);break;default:d('Unknown message type received from worker: "'+t+'"')}},T(e,this._onMessage)};W.prototype.dispatchMessage=function(t,n,o,e){f("Dispatch message to worker. (message: "+JSON.stringify(t)+")"),t.callbackId=this._genCallbackId(function(e){return e.status&&"SUCCESS"===e.status?n(e):(e.status,l("call API "+t.data.method+" from renderer failed: "+e.status+", "+e.error),o(e))},{keepAlive:e});try{t.keepAlive=!0,this.postMessage(t)}catch(e){o(e)}},W.prototype.postMessage=function(e){try{f("Call postMessage to worker. (message: "+JSON.stringify(e)+")"),T(this._weex,this._onMessage).postMessage(e)}catch(e){d(e.message||e.toString()||"postMessage failed.")}},W.prototype._genCallbackId=function(e,t){var n=t.keepAlive,o=t.callbackId,r=o||i();return this._emitter[n?"on":"once"]("callback@AppWorker:"+r,e),r},W.prototype.onReceiveMessage=function(e,t){var n=e.type,o=e.data;void 0===o&&(o={});var r=o.type;"Event"===n&&(r=x(r),o.type=r);var i=o.once?"once":"on";this._emitter[i](n+"."+r,t)},W.prototype.unbindEventListener=function(e,t){this._emitter.off(x(e),t)},W.prototype.emitEvent=function(e,t){void 0===t&&(t={});var n=x(e);this._emitter.emit("Event."+n,{type:n,data:t})};var B=function(n){function e(e,t){void 0===t&&(t={}),n.call(this),this._name=t.pageName||"",this.label=t.clientId||"",e&&p(e.config)&&(this._name=e.config.pageName||"",this.label=e.config.clientId||"",e.config.availableModules?(this.$registerModules(e.config.availableModules),this._gotAvailableModulesFromWeex=!0):h("No available modules in weex options.")),f("Create a new RendererRuntime. ("+this.label+", "+this._name+")"),this.bridge=new W(e,t),this._init()}return n&&(e.__proto__=n),((e.prototype=Object.create(n&&n.prototype)).constructor=e).prototype._init=function(){var t=this;this.bridge.onReceiveMessage({origin:"AppWorker",target:this.label,type:"Event",data:{type:"registerModules"}},function(e){e&&"registerModules"===e.type&&(f("Register available modules in renderer. ("+Object.keys(e.data)+")"),t.$registerModules(e.data))})},e.prototype.ready=function(){this.bridge.dispatchMessage({origin:this.label,target:"AppWorker",type:"Event",data:{type:"[[RendererRuntimeReady]]",data:{label:this.label,handshake:!this._gotAvailableModulesFromWeex}}},a,a)},e.prototype.$getCurrentActivePageId=function(){return this.label},e}(e),P=["$on","$once","$off","$emit","$cycle","$decycle","$call","$callAsync","$navTo","$getAvailableModules","$getCurrentActivePageId"];return function(e,t){var n=!(!e||!e.requireModule);!function(e){if(!e||!e.platform)return console.error("set logger environment failed.");Object.assign(g,e)}({platform:n&&e.config.env.platform,debugMode:n&&e.config.env.debugMode,isWeex:n}),f("Setup Windmill renderer framework."),e&&!e.requireModule&&(t=e,e=void 0),t||(t={}),f("Instantiate renderer in "+(((t=Object.assign({},t)).isWeex=n)?"Weex container":"WindVane container")+".");var o,r,i,a,s,c,l=new B(e,t),d=(o=l,r={},P.forEach(function(n){"function"==typeof o[n]&&(r[n]=function(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];return o[n].apply(o,e)})}),r);return f("Prepare runtime APIs: "+JSON.stringify(P)),t.exposeModuleGetter&&u("__WINDMILL_MODULE_GETTER__",(i=function(){return d},s=a||function(){for(var e,t=[],n=arguments.length;n--;)t[n]=arguments[n];return(e=i()).$call.apply(e,t)},c=a||function(){for(var e,t=[],n=arguments.length;n--;)t[n]=arguments[n];return(e=i()).$callSync.apply(e,t)},function(r){if(!r)return f("Require a universal module proxy."),{call:s};var e=m[r];if(Array.isArray(e)){f('Require the "'+r+'" module.');var t={};return e.forEach(function(n){if("string"==typeof n)t[n]=function(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];return s.apply(void 0,[r+"."+n].concat(e))};else if(p(n)&&n.name){var o=n.name;n.sync?t[o]=function(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];return c.apply(void 0,[r+"."+o].concat(e))}:t[o]=function(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];return s.apply(void 0,[r+"."+o].concat(e))}}}),t}h('Require unknown module "'+r+"\".It may not exist or haven't been registered.")})),l.ready(),d}});
